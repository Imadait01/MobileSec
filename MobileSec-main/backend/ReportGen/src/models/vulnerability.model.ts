import { z } from 'zod';

// Énumération des sévérités
export const SeverityEnum = z.enum(['critical', 'high', 'medium', 'low', 'info']);
export type Severity = z.infer<typeof SeverityEnum>;

// Énumération des catégories de vulnérabilités
export const CategoryEnum = z.enum([
  'injection',
  'xss',
  'secrets',
  'authentication',
  'authorization',
  'cryptography',
  'configuration',
  'dependency',
  'information-disclosure',
  'denial-of-service',
  'code-quality',
  'other'
]);
export type Category = z.infer<typeof CategoryEnum>;

// Énumération des niveaux de confiance
export const ConfidenceEnum = z.enum(['high', 'medium', 'low']);
export type Confidence = z.infer<typeof ConfidenceEnum>;

// Schéma de localisation
export const LocationSchema = z.object({
  file: z.string(),
  line: z.number().optional(),
  column: z.number().optional(),
  codeSnippet: z.string().optional(),
  endLine: z.number().optional(),
  endColumn: z.number().optional()
});
export type Location = z.infer<typeof LocationSchema>;

// Schéma CVSS
export const CVSSSchema = z.object({
  score: z.number().min(0).max(10),
  vector: z.string().optional()
});
export type CVSS = z.infer<typeof CVSSSchema>;

// Schéma de vulnérabilité normalisée
export const VulnerabilitySchema = z.object({
  id: z.string().uuid(),
  title: z.string(),
  severity: SeverityEnum,
  category: CategoryEnum,
  description: z.string(),
  location: LocationSchema,
  cwe: z.string().optional(),
  cvss: CVSSSchema.optional(),
  recommendation: z.string().optional(),
  references: z.array(z.string()).default([]),
  source: z.string(),
  confidence: ConfidenceEnum.default('medium'),
  detectedBy: z.array(z.string()).default([]),
  rawData: z.any().optional()
});
export type Vulnerability = z.infer<typeof VulnerabilitySchema>;

// Schéma pour créer une vulnérabilité (sans ID)
export const CreateVulnerabilitySchema = VulnerabilitySchema.omit({ id: true });
export type CreateVulnerability = z.infer<typeof CreateVulnerabilitySchema>;

// Mapping des sévérités pour le tri
export const severityOrder: Record<Severity, number> = {
  critical: 5,
  high: 4,
  medium: 3,
  low: 2,
  info: 1
};

// Couleurs associées aux sévérités
export const severityColors: Record<Severity, string> = {
  critical: '#DC2626',
  high: '#EA580C',
  medium: '#CA8A04',
  low: '#2563EB',
  info: '#6B7280'
};

// Labels des sévérités
export const severityLabels: Record<Severity, string> = {
  critical: 'Critique',
  high: 'Élevée',
  medium: 'Moyenne',
  low: 'Faible',
  info: 'Information'
};

// Labels des catégories
export const categoryLabels: Record<Category, string> = {
  injection: 'Injection',
  xss: 'Cross-Site Scripting (XSS)',
  secrets: 'Secrets exposés',
  authentication: 'Authentification',
  authorization: 'Autorisation',
  cryptography: 'Cryptographie',
  configuration: 'Configuration',
  dependency: 'Dépendances vulnérables',
  'information-disclosure': 'Divulgation d\'information',
  'denial-of-service': 'Déni de service',
  'code-quality': 'Qualité du code',
  other: 'Autre'
};
